<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Alerts - LogCloud</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ecf0f1;
        }
        
        .navbar {
            background-color: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar h1 { margin: 0; font-size: 24px; }
        
        .navbar-links a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 8px 16px;
            background-color: #34495e;
            border-radius: 5px;
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .filter-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 13px;
        }
        
        .filter-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        
        .btn-primary {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .alert-item {
            border-left: 4px solid #e74c3c;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #fff5f5;
            border-radius: 5px;
        }
        
        .alert-item.acknowledged {
            border-left-color: #f39c12;
            background-color: #fff9f0;
        }
        
        .alert-item.resolved {
            border-left-color: #27ae60;
            background-color: #f0fff4;
            opacity: 0.7;
        }
        
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .alert-type {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .severity {
            padding: 4px 12px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .severity-critical { background-color: #c0392b; color: white; }
        .severity-high { background-color: #e74c3c; color: white; }
        .severity-medium { background-color: #f39c12; color: white; }
        .severity-low { background-color: #3498db; color: white; }
        
        .alert-actions {
            margin-top: 15px;
        }
        
        .btn-acknowledge {
            background-color: #f39c12;
            color: white;
            padding: 8px 16px;
            margin-right: 10px;
        }
        
        .btn-resolve {
            background-color: #27ae60;
            color: white;
            padding: 8px 16px;
        }
        
        .alert-message {
            color: #555;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .alert-meta {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>üö® Security Alerts</h1>
        <div class="navbar-links">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('view_logs') }}">View Logs</a>
            <a href="{{ url_for('submit_log') }}">Submit Logs</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </nav>
    
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="card">
            <h2>Security Alerts ({{ alerts|selectattr('status', 'equalto', 'pending')|list|length }} pending)</h2>
            
            <!-- Filter -->
            <form method="GET" action="{{ url_for('filter_alerts') }}" class="filter-form">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>Status:</label>
                        <select name="status">
                            <option value="">All Statuses</option>
                            <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="acknowledged" {% if selected_status == 'acknowledged' %}selected{% endif %}>Acknowledged</option>
                            <option value="resolved" {% if selected_status == 'resolved' %}selected{% endif %}>Resolved</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Severity:</label>
                        <select name="severity">
                            <option value="">All Severities</option>
                            <option value="LOW" {% if selected_severity == 'LOW' %}selected{% endif %}>Low</option>
                            <option value="MEDIUM" {% if selected_severity == 'MEDIUM' %}selected{% endif %}>Medium</option>
                            <option value="HIGH" {% if selected_severity == 'HIGH' %}selected{% endif %}>High</option>
                            <option value="CRITICAL" {% if selected_severity == 'CRITICAL' %}selected{% endif %}>Critical</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Alert Type:</label>
                        <select name="alert_type">
                            <option value="">All Types</option>
                            <option value="Failed_login" {% if selected_alert_type == 'Failed_login' %}selected{% endif %}>Failed Login</option>
                            <option value="Unauthorized_access" {% if selected_alert_type == 'Unauthorized_access' %}selected{% endif %}>Unauthorized Access</option>
                            <option value="Brute_force" {% if selected_alert_type == 'Brute_force' %}selected{% endif %}>Brute Force</option>
                            <option value="Suspicious_activity" {% if selected_alert_type == 'Suspicious_activity' %}selected{% endif %}>Suspicious Activity</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">üîç Apply Filters</button>
                    <a href="{{ url_for('view_alerts') }}" class="btn btn-secondary">Clear Filters</a>
                </div>
            </form>
            
            <p style="color: #666; margin: 15px 0;">Showing {{ alerts|length }} alert(s)</p>
            
            {% if alerts %}
                {% for alert in alerts %}
                <div class="alert-item {{ alert.status }}">
                    <div class="alert-header">
                        <div class="alert-type">{{ alert.alertType.replace('_', ' ') }}</div>
                        <span class="severity severity-{{ alert.severity|lower }}">{{ alert.severity }}</span>
                    </div>
                    
                    <div class="alert-message">
                        {{ alert.description }}
                    </div>
                    
                    <div class="alert-meta">
                        Alert ID: {{ alert.alertID }} | 
                        Log ID: {{ alert.logID }} | 
                        Time: {{ alert.timestamp.strftime('%Y-%m-%d %H:%M:%S') }} | 
                        Status: <strong>{{ alert.status|upper }}</strong>
                    </div>
                    
                    {% if alert.status == 'pending' %}
                    <div class="alert-actions">
                    
             <form method="POST" action="{{ url_for('acknowledge_alert', alert_id=alert.alertID) }}" style="display: inline;">
                            <button type="submit" class="btn btn-acknowledge">‚úì Acknowledge</button>
                        </form>
                        <form method="POST" action="{{ url_for('resolve_alert', alert_id=alert.alertID) }}" style="display: inline;">
                            <button type="submit" class="btn btn-resolve">‚úì Resolve</button>
                        </form>
                    </div>
                    {% elif alert.status == 'acknowledged' %}
                    <div class="alert-actions">
                        <form method="POST" action="{{ url_for('resolve_alert', alert_id=alert.alertID) }}" style="display: inline;">
                            <button type="submit" class="btn btn-resolve">‚úì Resolve</button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>No alerts found. Your system is secure! üéâ</p>
            {% endif %}
        </div>
    </div>
</body>
</html>